<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Steroid Calculator & Plotter</title>
  <style>
    body { background: #1c1c1c; color: #f9f9f9; font-family: sans-serif; padding: 30px; }
    .container { max-width: 900px; margin: auto; padding: 20px; background: #1c1c1c; border: 1px solid #7a7a7a; border-radius: 10px; }
    label, input, select { display: block; width: 100%; margin-top: 10px; }
    input, select { padding: 8px; background: #111; border: 1px solid #7a7a7a; border-radius: 5px; color: #f9f9f9; }
    button { background: #b73239; color: white; padding: 12px; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; margin-top: 20px; }
    .compound-block { border-top: 1px solid #7a7a7a; padding-top: 15px; margin-top: 20px; }
    .results { margin-top: 30px; padding: 20px; background: #111; border: 1px solid #7a7a7a; border-radius: 10px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Injection Calculator & Blood Level Plotter</h2>

    <label>Number of Compounds</label>
    <input type="number" id="compoundCount" value="1" min="1" max="10" onchange="renderCompounds()" />

    <div id="compoundContainer"></div>

    <label>Injection Frequency (per week)</label>
    <select id="frequency">
      <option value="7">Every day (7x)</option>
      <option value="6">6x</option>
      <option value="5">5x</option>
      <option value="4">4x (Mon/Wed/Fri/Sun)</option>
      <option value="3">Every other day (~3x)</option>
      <option value="2">2x (e.g. Mon/Thu)</option>
      <option value="1">Once a week</option>
    </select>

    <label>Cycle Duration (weeks)</label>
    <input type="number" id="cycleWeeks" value="12" min="1" />

    <button onclick="calculate()">Calculate & Plot</button>

    <div id="resultBox" class="results"></div>
    <canvas id="chart" style="margin-top: 40px;"></canvas>
  </div>

  <!-- Chart.js and Annotation plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
  <script>
    // Must register the annotation plugin for it to take effect
    Chart.register(window['chartjs-plugin-annotation']);
  </script>

  <script>
    const steroidData = {
      "Boldenone Cypionate": 144, "Boldenone Undecylenate": 336, "Dihydroboldenone Cypionate": 144,
      "Drostanolone Enanthate": 120, "Drostanolone Propionate": 48, "Methandione Injectable": 6,
      "Methyldrostanolone Injectable": 12, "Methenolone Enanthate": 120, "Methenolone Acetate": 4,
      "Nandrolone Decanoate": 192, "Nandrolone Phenylpropionate": 96, "Stanozolol Suspension": 24,
      "Testosterone Acetate": 48, "Testosterone Base": 2, "Testosterone Cypionate": 144,
      "Testosterone Decanoate": 192, "Testosterone Enanthate": 120, "Testosterone Isocaproate": 144,
      "Testosterone Phenylpropionate": 96, "Testosterone Propionate": 48, "Testosterone Suspension": 24,
      "Testosterone Undercanoate": 1000, "Trestolone Acetate": 48, "Trestolone Enanthate": 120,
      "Trenbolone Acetate": 48, "Trenbolone Base": 6, "Trenbolone Enanthate": 120,
      "Trenbolone Hexahydrobenzyl Carbonate": 144,

      "Chlordehydromethyltestosterone": 12, "Fluoxymesterone Oral": 9, "Methandione Oral": 4,
      "Methyl-1-testosterone Oral": 4, "Methyldrostanolone Oral": 6, "Methylstenbolone Oral": 4,
      "Metribolone Oral": 6, "Oxandrolone Oral": 9, "Oxymetholone Oral (Anadrol)": 8,
      "Stanozolol Oral": 9,

      "Custom": null
    };

    function renderCompounds() {
      const container = document.getElementById("compoundContainer"), count = parseInt(document.getElementById("compoundCount").value);
      container.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const div = document.createElement("div");
        div.className = "compound-block";
        const injectables = Object.entries(steroidData).filter(([k]) => !k.includes("Oral") && k !== "Custom")
          .sort((a, b) => a[0].localeCompare(b[0]))
          .map(([k,v]) => `<option value="${k}">${k} (${v}h)</option>`).join("");
        const orals = Object.entries(steroidData).filter(([k]) => k.includes("Oral"))
          .sort((a,b) => a[0].localeCompare(b[0]))
          .map(([k,v]) => `<option value="${k}">${k} (${v}h)</option>`).join("");
        // ... binnen renderCompounds()
div.innerHTML = `
  <label>Compound ${i+1}</label>
  <select id="compound_${i}" onchange="toggleHalfLife(${i})">
    <optgroup label="Injectables">${injectables}</optgroup>
    <optgroup label="Orals">${orals}</optgroup>
    <optgroup label="Custom"><option value="Custom">Custom...</option></optgroup>
  </select>

  <div id="customHL_${i}" style="display:none;">
    <label>Half-Life (h)</label><input type="number" id="halfLife_${i}" />
  </div>

  <label>Weekly Dose (mg)</label><input type="number" id="weeklyDose_${i}" />
  ${
    name.includes("Oral")
      ? `<label>Dosage per Tab (mg)</label><input type="number" id="doseTab_${i}" />
         <label>Tabs per Bottle</label><input type="number" id="tabsBottle_${i}" />`
      : `<label>Concentration (mg/ml)</label><input type="number" id="concentration_${i}" />
         <label>Vial Size (ml)</label><input type="number" id="vialSize_${i}" />`
  }
`;

        container.appendChild(div);
      }
    }

    function toggleHalfLife(i) {
      document.getElementById(`customHL_${i}`).style.display = document.getElementById(`compound_${i}`).value === "Custom" ? "block" : "none";
    }

    renderCompounds();

    let chart;
    function calculate() {
      const freq = parseFloat(document.getElementById("frequency").value);
      const weeks = parseFloat(document.getElementById("cycleWeeks").value);
      const baseDays = weeks * 7;
      const compoundCount = parseInt(document.getElementById("compoundCount").value);
      const resultBox = document.getElementById("resultBox");  let totalWeekly = 0;
  let totalInjection = 0;
  let totalOralTabsPerWeek = 0;
  let totalOralTabsPerDay = 0;
  let latestClearance = 0;

      resultBox.innerHTML = "";

      const halfLives = Array.from({length:compoundCount}, (_, i) => {
        const n = document.getElementById(`compound_${i}`).value;
        const c = parseFloat(document.getElementById(`halfLife_${i}`)?.value || 0);
        return n === "Custom" ? c : steroidData[n];
      });
      const maxHL = Math.max(...halfLives);
      const totalDays = baseDays + Math.ceil((maxHL * 7) / 24);
      const labels = Array.from({length: totalDays}, (_, i) => `Day ${i+1}`);
      const datasets = [];
      let totalWeekly=0, totalInj=0, latestClr=0;

for (let i = 0; i < compoundCount; i++) {
  const name = document.getElementById(`compound_${i}`).value;
  const customHL = parseFloat(document.getElementById(`halfLife_${i}`)?.value || 0);
  const halfLife = name === "Custom" ? customHL : steroidData[name];

  const dose = parseFloat(document.getElementById(`weeklyDose_${i}`).value);

  if (!halfLife || !dose) {
    alert(`Vul alle velden in voor Compound ${i + 1}`);
    return;
  }

  const decayRate = Math.log(2) / halfLife;
  const data = Array(totalDays).fill(0);
  let compoundSummary = `<strong>${name}</strong><br>`;

  if (name.includes("Oral")) {
    const dosagePerTab = parseFloat(document.getElementById(`doseTab_${i}`).value);
    const tabsPerBottle = parseFloat(document.getElementById(`tabsBottle_${i}`).value);
    if (!dosagePerTab || !tabsPerBottle) {
      alert(`Vul dosering per tablet en aantal tabletten per fles voor ${name} in`);
      return;
    }

    const tabsPerWeek = dose / dosagePerTab;
    const tabsPerDay = tabsPerWeek / freq;
    const bottlesNeeded = (tabsPerWeek * weeks) / tabsPerBottle;
totalOralTabsPerWeek += tabsPerWeek;
totalOralTabsPerDay += tabsPerDay;

    totalInjection += tabsPerDay;

    compoundSummary += `
      Tabs per Week: ${tabsPerWeek.toFixed(1)}<br>
      Tabs per Day: ${tabsPerDay.toFixed(2)}<br>
      Bottles Needed: ${bottlesNeeded.toFixed(1)}<br>
    `;

    for (let d = 0; d < totalDays; d++) {
      data[d] = d < baseDays
        ? tabsPerDay * Math.pow(0.5, (d % (7 / freq)) * 24 / halfLife)
        : data[d - 1] * Math.pow(0.5, 24 / halfLife);
    }

  } else {
    const conc = parseFloat(document.getElementById(`concentration_${i}`).value);
    const vial = parseFloat(document.getElementById(`vialSize_${i}`).value);
    if (!conc || !vial) {
      alert(`Vul concentratie en vial size in voor ${name}`);
      return;
    }

    const weeklyML = dose / conc;
    const perInjection = weeklyML / freq;
    const totalML = weeklyML * weeks;
    const vialsNeeded = totalML / vial;

    totalWeekly += weeklyML;
    totalInjection += perInjection;

    compoundSummary += `
      Weekly Volume: ${weeklyML.toFixed(2)}ml<br>
      Per Injection: ${perInjection.toFixed(2)}ml<br>
      Vials Needed: ${vialsNeeded.toFixed(1)}<br>
    `;

    for (let d = 0; d < totalDays; d++) {
      data[d] = d < baseDays
        ? Array.from({length: Math.floor(d/(7/freq))+1}, (_, inj) => perInjection * Math.exp(-decayRate*(d-inj*((7/freq)))*24)).reduce((a,b)=>a+b,0)
        : data[d - 1] * Math.exp(-decayRate * 24);
    }
  }

  const clearanceDay = data.findIndex(val => val < 0.01);
  const postCycleWeeks = Math.max(0, Math.floor((clearanceDay + 1 - baseDays) / 7));
  compoundSummary += `Clearance Estimate: Day ${clearanceDay + 1} (~${postCycleWeeks} weeks post cycle)<br><br>`;

  resultBox.innerHTML += compoundSummary;

  datasets.push({
    label: name,
    data,
    borderColor: getRandomColor(),
    fill: false,
    tension: 0.3
  });

  if (clearanceDay > latestClearance) latestClearance = clearanceDay;
}

      const allPost = Math.max(0, Math.floor((latestClr+1-baseDays)/7));
      resultBox.innerHTML += `<hr>Total Weekly Injectable Volume: ${totalWeekly.toFixed(2)}ml
<br>Total Per Inj: ${totalInj.toFixed(2)}ml<br>Total Weekly Oral Tabs: ${totalOralTabsPerWeek.toFixed(1)}<br>
Total Daily Oral Tabs: ${totalOralTabsPerDay.toFixed(2)}<br>

<br><strong>All Clear By:</strong> Day ${latestClr+1} (~${allPost} wks post cycle)<br>`;

      if(chart) chart.destroy();
      const ctx = document.getElementById("chart").getContext("2d");
      chart = new Chart(ctx, {
        type:'line',
        data:{labels, datasets},
        options:{
          responsive:true,
          plugins:{
            legend:{labels:{color:'#f9f9f9'}},
            annotation:{
              annotations:{
                pctLine:{type:'line', xScaleID:'x', value: labels[latestClr], borderColor:'#e2a53e', borderWidth:2, borderDash:[6,6], label:{enabled:true, content:'📍 PCT Start', position:'start', backgroundColor:'#e2a53e', color:'#1c1c1c', font:{weight:'bold'}}}
              }
            }
          },
          scales:{x:{ticks:{color:'#f9f9f9'}, title:{display:true,text:'Days',color:'#f9f9f9'}}, y:{ticks:{color:'#f9f9f9'}, title:{display:true,text:'Active Level',color:'#f9f9f9'}}}
        }
      });
    }

    function getRandomColor(){ const [r,g,b] = Array(3).fill().map(_=>Math.floor(Math.random()*200)); return `rgb(${r},${g},${b})`; }
  </script>
</body>
</html>
