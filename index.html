<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Steroid Calculator & Plotter</title>
  <style>
    body { background:#1c1c1c; color:#f9f9f9; font-family:sans-serif; padding:30px; }
    .container { max-width:900px; margin:auto; padding:20px; background:#1c1c1c; border:1px solid #7a7a7a; border-radius:10px; }
    label,input,select { display:block; width:100%; margin-top:10px; }
    input,select { padding:8px; background:#111; border:1px solid #7a7a7a; border-radius:5px; color:#f9f9f9; }
    button { background:#b73239; color:#fff; padding:12px; border:none; border-radius:25px; font-weight:bold; cursor:pointer; margin-top:20px; }
    .compound-block { border-top:1px solid #7a7a7a; padding-top:15px; margin-top:20px; }
    .results { margin-top:30px; padding:20px; background:#111; border:1px solid #7a7a7a; border-radius:10px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Steroid Injection + Oral Dosing Planner</h2>

    <label>Number of Compounds</label>
    <input type="number" id="compoundCount" value="1" min="1" max="10" onchange="renderCompounds()" />

    <div id="compoundContainer"></div>

    <label>Injection Frequency (per week)</label>
    <select id="frequency">
      <option value="7">Every day (7x)</option>
      <option value="6">6x/week</option>
      <option value="5">5x/week</option>
      <option value="4">4x/week</option>
      <option value="3">3x/week</option>
      <option value="2">Twice a week</option>
      <option value="1">Once a week</option>
    </select>

    <label>Cycle Duration (weeks)</label>
    <input type="number" id="cycleWeeks" value="12" min="1" />

    <button onclick="calculate()">Calculate & Plot</button>

    <div class="results" id="resultBox"></div>
    <canvas id="chart" style="margin-top:40px;"></canvas>
    <div id="emailContainer" style="margin-top:20px; display:none;">
  <label>Want this as a PDF? Enter your email:</label>
  <input type="email" id="userEmail" placeholder="Your email address" />
  <button id="sendPdfBtn">Send PDF</button>
  <span id="sendStatus" style="margin-left:10px;"></span>
</div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const steroidData = {
            "Boldenone Cypionate": 144,
      "Boldenone Undecylenate": 336,
      "Dihydroboldenone Cypionate": 144,
      "Drostanolone Enanthate": 120,
      "Drostanolone Propionate": 48,
      "Methandione Injectable": 6,
      "Methyldrostanolone Injectable": 12,
      "Methenolone Enanthate": 120,
      "Methenolone Acetate": 4,
      "Nandrolone Decanoate": 192,
      "Nandrolone Phenylpropionate": 96,
      "Stanozolol Suspension": 24,
      "Testosterone Acetate": 48,
      "Testosterone Base": 2,
      "Testosterone Cypionate": 144,
      "Testosterone Decanoate": 192,
      "Testosterone Enanthate": 120,
      "Testosterone Isocaproate": 144,
      "Testosterone Phenylpropionate": 96,
      "Testosterone Propionate": 48,
      "Testosterone Suspension": 24,
      "Testosterone Undercanoate": 1000,
      "Trestolone Acetate": 48,
      "Trestolone Enanthate": 120,
      "Trenbolone Acetate": 48,
      "Trenbolone Base": 6,
      "Trenbolone Enanthate": 120,
      "Trenbolone Hexahydrobenzyl Carbonate": 144,
      "Chlordehydromethyltestosterone": 12,
      "Fluoxymesterone Oral": 9,
      "Methandione Oral": 4,
      "Methyl-1-testosterone Oral": 4,
      "Methyldrostanolone Oral": 6,
      "Methylstenbolone Oral": 4,
      "Metribolone Oral": 6,
      "Oxandrolone Oral": 9,
      "Oxymetholone Oral (Anadrol)": 8,
      "Stanozolol Oral": 9,
      "Custom": null

    };

    function renderCompounds() {
  const container = document.getElementById("compoundContainer");
  const count = parseInt(document.getElementById("compoundCount").value);
  container.innerHTML = "";

  for (let i = 0; i < count; i++) {
    const div = document.createElement("div");
    div.className = "compound-block";

    const injectableOptions = Object.entries(steroidData)
      .filter(([name]) => !name.includes("Oral") && name !== "Custom")
      .sort()
      .map(([name, hl]) => `<option value="${name}">${name} (${hl}h)</option>`)
      .join("");

    const oralOptions = Object.entries(steroidData)
      .filter(([name]) => name.includes("Oral"))
      .sort()
      .map(([name, hl]) => `<option value="${name}">${name} (${hl}h)</option>`)
      .join("");

    div.innerHTML = `
      <label>Compound ${i + 1}</label>
      <select id="compound_${i}" onchange="toggleFields(${i})">
        <optgroup label="Injectables">${injectableOptions}</optgroup>
        <optgroup label="Orals">${oralOptions}</optgroup>
        <optgroup label="Custom"><option value="Custom">Custom (enter manually)</option></optgroup>
      </select>

      <div id="customHL_${i}" style="display:none;">
        <label>Custom Half-Life (h)</label>
        <input type="number" id="halfLife_${i}" />
      </div>

      <label>Weekly Dose (mg)</label>
      <input type="number" id="weeklyDose_${i}" />

      <div id="injectable_${i}">
        <label>Concentration (mg/ml)</label>
        <input type="number" id="concentration_${i}" />
        <label>Vial Size (ml)</label>
        <input type="number" id="vialSize_${i}" />
      </div>

      <div id="oral_${i}" style="display:none;">
        <label>Dosage per Tab (mg)</label>
        <input type="number" id="doseTab_${i}" />
        <label>Tabs per Bottle</label>
        <input type="number" id="tabsBottle_${i}" />
        <label>Doses per Day</label>
        <select id="oralFreq_${i}">
          <option value="1">Once daily</option>
          <option value="2">Twice daily</option>
          <option value="3">Three times daily</option>
        </select>
      </div>
    `;

    container.appendChild(div);
    toggleFields(i);
  }
}


    function toggleFields(i) {
      const val = document.getElementById(`compound_${i}`).value;
      document.getElementById(`customHL_${i}`).style.display = val === "Custom" ? "block" : "none";
      const isOral = val.includes("Oral");
      document.getElementById(`oral_${i}`).style.display = isOral ? "block" : "none";
      document.getElementById(`injectable_${i}`).style.display = isOral ? "none" : "block";
    }

    document.addEventListener("DOMContentLoaded", renderCompounds);

    function getRandomColor() {
      return `rgb(${[...Array(3)].map(_ => Math.floor(Math.random()*200)).join(',')})`;
    }

    let chart;
    function calculate() {
      const freq = parseFloat(document.getElementById("frequency").value);
      const weeks = parseFloat(document.getElementById("cycleWeeks").value);
      const baseDays = weeks * 7;
      const count = parseInt(document.getElementById("compoundCount").value);
      const resultBox = document.getElementById("resultBox");
      resultBox.innerHTML = "";

      const totalHL = Array.from({ length: count }, (_, i) => {
        const name = document.getElementById(`compound_${i}`).value;
        const hl = parseFloat(document.getElementById(`halfLife_${i}`)?.value) || steroidData[name];
        return hl;
      });
      const totalDays = baseDays + Math.ceil(Math.max(...totalHL) * 7 / 24);
      const labels = Array.from({ length: totalDays }, (_, d) => `Day ${d+1}`);
      const datasets = [];

 let totalInjVol = 0;
let totalInjection = 0;
let totalTabsW = 0;
let totalTabsD = 0;
      let totalVials = 0;
let totalBottles = 0;

      for (let i = 0; i < count; i++) {
        const name = document.getElementById(`compound_${i}`).value;
        const hl = name === "Custom" ? parseFloat(document.getElementById(`halfLife_${i}`).value) : steroidData[name];
        const doseMg = parseFloat(document.getElementById(`weeklyDose_${i}`).value) || 0;

        if (!hl || !doseMg) { alert(`Fill fields for compound ${i+1}`); return; }

        const decay = Math.log(2) / hl;
        const data = Array(totalDays).fill(0);
        let summary = `<strong>${name}</strong><br>`;

        if (name.includes("Oral")) {
          const doseTab = parseFloat(document.getElementById(`doseTab_${i}`).value);
          const tabsBottle = parseFloat(document.getElementById(`tabsBottle_${i}`).value);
          const oralFreq = parseFloat(document.getElementById(`oralFreq_${i}`).value);
           const tabsWeek = doseMg / doseTab;
    const tabsDay = tabsWeek / 7;
    const tabsDose = tabsDay / oralFreq;
    const bottles = (tabsWeek * weeks) / tabsBottle;

          if (!doseTab || !tabsBottle) { alert(`Complete oral fields for compound ${i+1}`); continue; }

          totalTabsW += tabsWeek;
          totalTabsD += tabsDay;

          summary += `Tabs/Week: ${tabsWeek.toFixed(1)}<br>`;
          summary += `Doses/day: ${oralFreq} — Tabs/Dose: ${tabsDose.toFixed(2)}<br>`;
          summary += `Bottles Needed: ${bottles.toFixed(1)}<br>`;

          for (let d = 0; d < totalDays; d++) {
            if (d < baseDays) {
              for (let k = 0; k < oralFreq; k++) {
                data[d] += tabsDose * Math.exp(-decay * (24 / oralFreq) * k);
              }
            } else data[d] = data[d-1] * Math.exp(-decay * 24);
          }

        } else {
          const conc = parseFloat(document.getElementById(`concentration_${i}`).value) || 0;
          const vialSize = parseFloat(document.getElementById(`vialSize_${i}`).value) || 0;
          if (!conc || !vialSize) { alert(`Complete injectable fields for compound ${i+1}`); continue; }

          const weeklyML = doseMg / conc;
          const perInj = weeklyML / freq;
          totalInjVol += weeklyML;
          totalInjection += perInj;
           const totalML = weeklyML * weeks;
        const vials = totalML / vialSize;
          summary += `Weekly Vol: ${weeklyML.toFixed(2)}ml — Per Inj: ${perInj.toFixed(2)}ml<br>';
          summary += `Vials Needed: ${vials.toFixed(1)}<br>`;

          for (let d = 0; d < totalDays; d++) {
            if (d < baseDays) {
              const injCount = Math.floor(d / (7 / freq)) + 1;
              for (let inj = 0; inj < injCount; inj++) {
                const t = d - inj * (7 / freq);
                data[d] += perInj * Math.exp(-decay * t * 24);
              }
            } else data[d] = data[d-1] * Math.exp(-decay * 24);
          }
        }

        summary += `<br>`;
        resultBox.innerHTML += summary;

        datasets.push({ label: name, data, borderColor: getRandomColor(), fill: false, tension: 0.3 });
      }

      resultBox.innerHTML += `
            Total Injectable Volume: ${totalInjVol.toFixed(2)}ml<br>
              Total Per Injection Volume: ${totalInjection.toFixed(2)}ml<br>
              Total Vials Needed: ${totalVials.toFixed(1)}<br>
  Total Weekly Oral Tabs: ${totalTabsW.toFixed(1)} — Daily: ${totalTabsD.toFixed(2)}<br>
  Total Bottles Needed: ${totalBottles.toFixed(1)}<br>
              `;

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("chart").getContext("2d"), {
        type: 'line',
        data: { labels, datasets },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: "#f9f9f9" } } },
          scales: {
            x: { ticks: { color: "#f9f9f9" }, title: { display: true, text: "Days", color: "#f9f9f9" } },
            y: { ticks: { color: "#f9f9f9" }, title: { display: true, text: "Active Level", color: "#f9f9f9" } },
          }
        }
      });
      document.getElementById('emailContainer').style.display = 'block';

document.getElementById('sendPdfBtn').onclick = async () => {
  const email = document.getElementById('userEmail').value;
  if (!email) return alert('Please enter your email.');

  document.getElementById('sendStatus').innerText = 'Sending…';

  try {
    const response = await fetch('/.netlify/functions/sendPdf', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        to: email,
        html: document.getElementById('resultBox').innerHTML
      })
    });

    const result = await response.json();
    console.log('Function response:', result);

    document.getElementById('sendStatus').innerText = result.success 
      ? 'Sent!' 
      : `Error: ${result.error || 'Unknown error'}`;
  } catch (err) {
    console.error('Fetch error:', err);
    document.getElementById('sendStatus').innerText = `Network error: ${err.message}`;
  }
};


    }
  </script>

</body>
</html>
